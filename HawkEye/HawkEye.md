# HawkEye

| Malware Name | File Type | SHA256 |
| --- | ----------- | ----------- |
| HawkEye | x32 exe (.NET) | b9561f35b2fa188ed20de24bb67956e15858aeb67441fb31cbcfe84e1d4edc9a |


## Analysis process

The file is a Dotnet PE:

![i](/HawkEye/img/1.PNG)

On execution the file spawns a child process of the legitimate Dotnet AppLaunch.exe:

![i](/HawkEye/img/2.PNG)

There is only one reason to do that - Process Hollowing (A.K.A RunPE).
As i learned from the great [OALabs channel](https://www.youtube.com/c/OALabs), whenever you want to break with a dubugger on an injection to a remote process, `CreateProcessInternalW` and `WriteProcessMemory` are the first calls that you want to put a break on. doing as i learned gave me a quick treat:

![i](/HawkEye/img/3.PNG)

The malware is calling to `CreateProcessInternalW`, pass AppLaunch.exe as a parameter, and "4" as seventh argument which will make the process in suspended mode (Process Hollowing creates a process in suspended mode so it can hollows out the process, inject, and then execute).

We could manually find the unpacked PE in memory and dump it, and we also can be lazy and let great Hollows_Hunter.exe do it for us:

![i](/HawkEye/img/4.PNG)

:blush:

Dropping the unpacked (Dotnet as well) to Dnspy hollows out our eyes :fearful::

![i](/HawkEye/img/5.PNG)

Not sure if the file dumped successfully or this one is perfectly obfuscated. Trying to deobfuscate with De4dot:

![i](/HawkEye/img/6.PNG)

is throwing an error.. a closer look at the file in Dnspy reveals the obfuscator which apparently is not supported / known by De4dot:

![i](/HawkEye/img/7.PNG)

Some googling on deobfuscating ConfuserEx gives us this [project](https://github.com/ViRb3/de4dot-cex) which adds to De4dot exactly this capability:

![i](/HawkEye/img/8.PNG)

Now the file is dumped and cleand (pretty much) :sunglasses:.

Analyzing the code (which is still a bit obfuscated) reveals that this is a kelogger / stealer (with some RAT capabilities) named HawkEye Reborn version 8:

![i](/HawkEye/img/9.PNG)

[Description](https://malpedia.caad.fkie.fraunhofer.de/details/win.hawkeye_keylogger) from Malpedia:

> HawKeye is a keylogger that is distributed since 2013. Discovered by IBM X-Force, it is currently spread over phishing campaigns targeting businesses on a worldwide scale. It is designed to steal credentials from numerous applications but, in the last observed versions, new "loader capabilities" have been spotted. It is sold by its development team on dark web markets and hacking forums.

From here on i used only static analysis on the unpacked sample


### Anti-Analysis capabilities

Checks if it runs under process monitor software:

![i](/HawkEye/img/10.PNG)

Checks installed security products and analysis tools:

![i](/HawkEye/img/10_.PNG)

Checks if it runs under Sandboxie (SbieDll.dll) or Wireshark:

![i](/HawkEye/img/11.PNG)

Disables Task Manager, Cmd, and Regedit:

![i](/HawkEye/img/12.PNG)

![i](/HawkEye/img/13.PNG)

Sets hidden + system attributes for itself:

![i](/HawkEye/img/14.PNG)

The malware has the functionality to block websites by overriding the Hosts file and redirect them to the localhost address:

![i](/HawkEye/img/15.PNG)


### Stealing capabilities

The malware has Keylogging capabilities (Also called HawkEye Keylogger):

![i](/HawkEye/img/16.PNG)

Takes screenshots of the infected computer:

![i](/HawkEye/img/17.PNG)

Steals Chrome browser data:

![i](/HawkEye/img/18.PNG)

Steals Firefox browser data:

![i](/HawkEye/img/19.PNG)

Steals CoreFTP software data:

![i](/HawkEye/img/20.PNG)

Steals Minecraft data:

![i](/HawkEye/img/21.PNG)

Collects a plenty of more information: internal & external address, geolocation, installed software, clipboard content, screenshots, passwords and more:

![i](/HawkEye/img/22.PNG)

![i](/HawkEye/img/23.PNG)

And post all the data to the C2:

![i](/HawkEye/img/24.PNG)

> C2: pomf.cat


### Persistence:

The malware persist itself via a run key:

![i](/HawkEye/img/25.PNG)


### More capabilities:

The malware uses P/Invoke calls to native libraries to extend the capabilities and harden the analysis:

![i](/HawkEye/img/26.PNG)

Seems like the next commands are used to be written into a .bat file that responsible for the persistence via the run key, it's executes the malware, and then possibly deletes itself (and written back next execution, depending if is written to "run" or "runonce"):

![i](/HawkEye/img/27.PNG)

Also, the malware seems to inject itself into a remote process due to the these API calls:

![i](/HawkEye/img/28.PNG)



** That's it for today, hope you enjoyed :relaxed:**

















